axis.text.y = element_text(size = 14),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
labs(color="Risk of infection")+
theme(strip.text.x = element_text(size = 14))+
theme(plot.margin = margin(0.75,0.75, 0.75, 0.75, "cm")) +
labs( tag = "(D)")
p2
plot<-plot_grid(p1,p2,  align = "h", axis = "b",rel_heights = c(1,1),rel_widths = c(2,1),ncol=2)
plot
#Scenario 1:
#different prortions of the infected people get the theraputic treatment;
# variant number anc,ba1,ba1_1,ba2,ba45 = 1, 2, 3, 4, 5
library(reshape2)
library(ggplot2)
library(data.table)
library(ggpubr)
library(RColorBrewer)
library(ggthemes)
library(dplyr)
library(tidyr)
library(gridExtra)
library(metR)
# Run the R scripts in the R/ folder with your custom functions:
. <- lapply(list.files("R", full.names = TRUE), source)
N=1000
drug_number= 3
r_bi=seq(0,1,by=0.1)
#risk of hospitalisations
r_bh=seq(0,1,by=0.1)
risks=expand.grid(r_bi,r_bh)
q=nrow(risks)
overall_risk=risks[,1]*risks[,2]
lr=length(overall_risk)
dat=data.frame("risk_infection"=risks[,1],"risk_hos"=risks[,2],"avoided_hos"=NA,"doses"=NA,"hos_per_dose"=NA,"method"=rep("Theraputic only"))
hos_dat=matrix(NA,ncol = 2,nrow = 0)
#scenarios 1; All infected people get therapeutic:
for (i in 1:q) {
r_b_i=risks[i,1]
r_b_h=risks[i,2]
out_1=get_hos_theraputic2(N,drug_number,r_b_i,r_b_h)
hos_dat=rbind(hos_dat,out_1)
}
dat[,3:4]=hos_dat
dat$hos_per_dose=dat$avoided_hos/dat$doses
#scenarios 2: everyone in the population get prohylaxis:
dat2=data.frame("risk_infection"=risks[,1],"risk_hos"=risks[,2],"avoided_hos"=NA,"doses"=NA,"hos_per_dose"=NA,"method"=rep("Prophylaxis only"))
hos_dat2=matrix(NA,ncol = 2,nrow = 0)
tspan=seq(0,179,by=1)
#tspan=0
pp=1 #treat total pop as prohylaxis
others=1 # 1 0r 2
for (i in 1:q) {
r_b_i=risks[i,1]
r_b_h=risks[i,2]
out_2=get_hos_time_pp_ther(N,tspan,drug_number,r_b_i,r_b_h,pp,others)
#out_2=get_hos_no_deacy2(N,drug_number,r_b_i,r_b_h,pp,others)
hos_dat2=rbind(hos_dat2,out_2[1:2])
}
# Run the R scripts in the R/ folder with your custom functions:
. <- lapply(list.files("R", full.names = TRUE), source)
N=1000
drug_number= 3
r_bi=seq(0,1,by=0.1)
#risk of hospitalisations
r_bh=seq(0,1,by=0.1)
risks=expand.grid(r_bi,r_bh)
q=nrow(risks)
overall_risk=risks[,1]*risks[,2]
lr=length(overall_risk)
dat=data.frame("risk_infection"=risks[,1],"risk_hos"=risks[,2],"avoided_hos"=NA,"doses"=NA,"hos_per_dose"=NA,"method"=rep("Theraputic only"))
hos_dat=matrix(NA,ncol = 2,nrow = 0)
#scenarios 1; All infected people get therapeutic:
for (i in 1:q) {
r_b_i=risks[i,1]
r_b_h=risks[i,2]
out_1=get_hos_theraputic2(N,drug_number,r_b_i,r_b_h)
hos_dat=rbind(hos_dat,out_1)
}
dat[,3:4]=hos_dat
dat$hos_per_dose=dat$avoided_hos/dat$doses
#scenarios 2: everyone in the population get prohylaxis:
dat2=data.frame("risk_infection"=risks[,1],"risk_hos"=risks[,2],"avoided_hos"=NA,"doses"=NA,"hos_per_dose"=NA,"method"=rep("Prophylaxis only"))
hos_dat2=matrix(NA,ncol = 2,nrow = 0)
tspan=seq(0,179,by=1)
#tspan=0
pp=1 #treat total pop as prohylaxis
others=1 # 1 0r 2
for (i in 1:q) {
r_b_i=risks[i,1]
r_b_h=risks[i,2]
out_2=get_hos_time_pp_ther(N,tspan,drug_number,r_b_i,r_b_h,pp,others)
#out_2=get_hos_no_deacy2(N,drug_number,r_b_i,r_b_h,pp,others)
hos_dat2=rbind(hos_dat2,out_2[1:2])
}
dat2[,3:4]=hos_dat2
dat2$doses=dat2$doses+N #all get prohylaxis doses
dat2$hos_per_dose=dat2$avoided_hos/(dat2$doses)
dat3=data.frame("risk_infection"=risks[,1],"risk_hos"=risks[,2],"avoided_hos"=NA,"doses"=N,"hos_per_dose"=NA,"method"=rep("Ratio"))
dat3$hos_per_dose=dat2$hos_per_dose/dat$hos_per_dose #prohylaxis/theraputic
dat3$avoided_hos=dat2$avoided_hos/dat$avoided_hos
all_dat=rbind(dat,dat2)
meth_lvs=c("Theraputic only","Prophylaxis only")
all_dat$method=factor(all_dat$method,levels = meth_lvs)
#which risks are better under prohylaxis:
xx=which(dat3$hos_per_dose>=1)
yy=dat3$risk_hos
zz=dat3$risk_infection
dd=data.frame(xx,min(zz[xx]),(yy[xx]))
colnames(dd)<-c("index","risk_infection","risk_hos")
#which risks have 0.4 hos averted per dose
ind=which(all_dat$hos_per_dose>=0.4)
d_0.4<-data.frame("index"=ind,"risk_infection"=(all_dat$risk_infection[ind]),"risk_hos"=(all_dat$risk_hos[ind]),
"method"=all_dat$method[ind],all_dat$hos_per_dose[ind])
d_t=subset(d_0.4,method=="Theraputic only")
d_p=subset(d_0.4,method=="Prophylaxis only")
dd_4=data.frame("risk_infection"=c(min(d_t$risk_infection),min(d_p$risk_infection)),"risk_hos"=c(min(d_t$risk_hos),min(d_p$risk_hos)),
"method"=c("Theraputic only","Prophylaxis only"))
p1<-ggplot(all_dat,aes(x=risk_infection,y=risk_hos,z=avoided_hos/N))+
geom_contour()+
geom_contour_filled()+
metR::geom_text_contour(aes(z = avoided_hos/N),skip=1,rotate = F,color="black")+
facet_wrap(~method,ncol =2)+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(12)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
labs(fill="Proportion of hospitalisations avoided")+
theme(strip.text.x = element_text(size = 14))+
theme(plot.margin = margin(0.75,0.75, 0.75, 0.75, "cm")) +
labs( tag = "(A)")
p1
ind_x=min(which(dat3$avoided_hos>=1))
xx=dat3$risk_infection[ind_x]
p2<-ggplot(dat3,aes(x=risk_infection,y=risk_hos,z=avoided_hos))+
geom_tile(alpha=0.9)+
geom_contour()+
geom_contour_filled()+
metR::geom_text_contour(aes(z = avoided_hos),skip=1,rotate = F,color="black")+
#geom_vline(xintercept = xx,linetype="twodash")+
#geom_text(aes(x=xx+0.025,y=0.25,label="Ratio = 1"))+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(12)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
ggtitle("Ratio")+
labs(fill="Ratio of hospitalisations \n avoided \n between prohylaxis and theraputic")+
theme(plot.margin = margin(0.75,0.75, 0.75, 0.75, "cm"))+
labs( tag = "(B)")
p2
library(cowplot)
plot<-plot_grid(p1,p2,  align = "h", axis = "b",rel_heights = c(1,1),rel_widths = c(2,1),ncol=1)
plot
library(viridis)
# Run the R scripts in the R/ folder with your custom functions:
. <- lapply(list.files("R", full.names = TRUE), source)
N=1000
drug_number= 3
r_bi=seq(0,1,by=0.1)
#risk of hospitalisations
r_bh=seq(0,1,by=0.1)
risks=expand.grid(r_bi,r_bh)
q=nrow(risks)
overall_risk=risks[,1]*risks[,2]
lr=length(overall_risk)
#available proprtion of doses out of the total population:
av_doses=seq(0.1,1,by=0.1)*N
#av_doses=0.5*N
m=length(av_doses)
#proportion of people that get the treatment
pp=seq(0,1,by=0.1) #prohylaxis proprtion out of total availble doses
n=length(pp)
comb=expand.grid(av_doses,pp,r_bi,r_bh)
dat=data.frame("availble_doses"=comb[,1] , "prop_prohylaxis"=comb[,2],"risk_infection"=comb[,3],
"risk_hos"=comb[,4],"avoided_hos"=NA,"theraputic_doses"=NA,"prohy_inf"=NA, "other_inf"=NA,
"total_inf"=NA,"total_doses"=NA)
nq=nrow(dat)
tspan=seq(0,179,by=1)
dat_hos=matrix(NA,nrow = 0,ncol = 4)
for (i in 1:nq) {
r_b_i=dat$risk_infection[i]
r_b_h=dat$risk_hos[i]
p_p=dat$prop_prohylaxis[i]
av_d=dat$availble_doses[i]
out=get_hos_time_pp_ther_prohy2(N,tspan,drug_number,r_b_i,r_b_h,av_d,p_p)
dat_hos=rbind(dat_hos,out)
}
out=get_hos_time_pp_ther_prohy2(N,tspan,drug_number,r_b_i,r_b_h,av_d,p_p,0.87,0.9443,0.67)
for (i in 1:nq) {
r_b_i=dat$risk_infection[i]
r_b_h=dat$risk_hos[i]
p_p=dat$prop_prohylaxis[i]
av_d=dat$availble_doses[i]
out=get_hos_time_pp_ther_prohy2(N,tspan,drug_number,r_b_i,r_b_h,av_d,p_p,0.87,0.9443,0.67)
dat_hos=rbind(dat_hos,out)
}
dat[,5:8]=dat_hos
dat$total_inf=dat$prohy_inf+dat$other_inf
dat$total_doses=((dat$prop_prohylaxis)*dat$availble_doses)+dat$theraputic_doses
dat$overall_risk=rep(overall_risk)
dat$hos_per_dose=dat$avoided_hos/dat$total_doses
new_dat=data.frame("availble_doses"=rep(av_doses,each=q),"risk_infection"=rep(risks[,1]),
"risk_hos"=rep(risks[,2]),"optimal_prohylaxis_dose"=NA,"max_avoided_hos_per_dose"=NA,"total_theraputic_administered"=NA,
"hos_avoded"=NA)
new_ln=nrow(new_dat)
#subset each risk groups:
for (j in 1:new_ln) {
risk_dat=subset(dat,risk_infection==new_dat$risk_infection[j] & risk_hos==new_dat$risk_hos[j] & availble_doses==new_dat$availble_doses[j])
#find which proprtion of that risk group gives the max avoided hos per dose
navd=new_dat$availble_doses[j] #availble doses
ind_pro=which.max(risk_dat$hos_per_dose)
if(length(ind_pro)>0){
pro=risk_dat$prop_prohylaxis[ind_pro]
new_dat$optimal_prohylaxis_dose[j]=pro
#which is the maxmimum avoided hos per doses
m_hos=risk_dat$hos_per_dose[ind_pro]
new_dat$max_avoided_hos_per_dose[j]=m_hos
#ttal doses administered out of availble doses
m_ad_doses=risk_dat$theraputic_doses[ind_pro]
new_dat$total_theraputic_administered[j]=m_ad_doses/navd
new_dat$hos_avoded[j]=risk_dat$avoided_hos[ind_pro]
}
}
new_dat$availble_doses=new_dat$availble_doses/N
sub_dat=subset(new_dat,availble_doses==0.5)
ind_x=min(which(sub_dat$optimal_prohylaxis_dose==1))
xx=sub_dat$risk_infection[ind_x]
new_dat$availble_doses=factor(new_dat$availble_doses,levels = paste0(seq(0.1,1,by=0.1)))
availble_doses.labs=paste0("Proportion of available doses: ", seq(0.1:1,by=0.1))
names(availble_doses.labs)=paste0(seq(0.1:1,by=0.1))
p1<-ggplot(data=new_dat,aes(x=risk_infection,y=risk_hos,fill=max_avoided_hos_per_dose))+
geom_tile()+
scale_fill_viridis()+
geom_vline(data=NULL,xintercept = xx,linetype="twodash")+
facet_wrap(~availble_doses,ncol = 5,labeller = labeller(availble_doses=availble_doses.labs))+
# geom_text(aes(label=optimal_prohylaxis_dose),size=1.7)+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(14)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
labs(fill="Maximum hospitalisations avoided per dose")
p1
sub_dat=subset(new_dat,availble_doses==0.5)
ind_x=min(which(sub_dat$optimal_prohylaxis_dose==1))
xx=sub_dat$risk_infection[ind_x]
pl=ggplot(sub_dat, aes(x=risk_infection,y=risk_hos,fill=max_avoided_hos_per_dose)) +
geom_tile()+
scale_fill_viridis()+
#  geom_text(aes(label=optimal_prohylaxis_dose),size=2)+
geom_vline(data=NULL,xintercept = xx,linetype="twodash")+
geom_text(aes(x=xx+0.025,y=0.25,label="Prohylaxis doses = available doses"),color="white")+
# geom_text(aes(label=total_theraputic_administered),size=2,color="red")+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(14)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
#ggtitle("Ratio")+
labs(fill="Maximum of hospitalisations avoided per dose")
pl
px=ggplot(sub_dat, aes(x=risk_infection,y=risk_hos,fill=hos_avoded/N)) +
geom_tile()+
scale_fill_viridis()+
#  geom_text(aes(label=optimal_prohylaxis_dose),size=2)+
geom_vline(data=NULL,xintercept = xx,linetype="twodash")+
geom_text(aes(x=xx+0.025,y=0.25,label="Total prohylaxis doses = available doses"))+
# geom_text(aes(label=total_theraputic_administered),size=2,color="red")+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(14)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
#ggtitle("Ratio")+
labs(fill="Maximum of proportion of hospitalisations avoided")
px
d5_sub=subset(dat,availble_doses==100 & risk_infection>0 & risk_hos>0)
d5_sub$risk_hos=factor(d5_sub$risk_hos,levels = paste0(seq(0.1:1,by=0.1)))
risk_hos.labs=paste0("Risk of infection: ", seq(0.1:1,by=0.1))
names(risk_hos.labs)=paste0(seq(0.1:1,by=0.1))
p2<-ggplot(d5_sub,aes(x=prop_prohylaxis,y=hos_per_dose,color=as.factor(risk_infection)))+
geom_line()+
# scale_color_brewer(palette = "RdYlBu")+
facet_wrap(~risk_hos,ncol=5,labeller =  labeller(risk_hos=risk_hos.labs))+
xlab("Proportion of prohylaxis doses out of availble doses")+
ylab("Hospitalisations avoided per dose")+
theme_minimal()+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
ggtitle("Proportion of availble doses out of the total population = 0.1")+
labs(color="Risk of infection")
p2
d5_sub=subset(dat,availble_doses==500 & risk_infection>0 & risk_hos>0)
d5_sub$risk_hos=factor(d5_sub$risk_hos,levels = paste0(seq(0.1:1,by=0.1)))
risk_hos.labs=paste0("Risk of infection: ", seq(0.1:1,by=0.1))
names(risk_hos.labs)=paste0(seq(0.1:1,by=0.1))
p2<-ggplot(d5_sub,aes(x=prop_prohylaxis,y=hos_per_dose,color=as.factor(risk_infection)))+
geom_line()+
# scale_color_brewer(palette = "RdYlBu")+
facet_wrap(~risk_hos,ncol=5,labeller =  labeller(risk_hos=risk_hos.labs))+
xlab("Proportion of prohylaxis doses out of availble doses")+
ylab("Hospitalisations avoided per dose")+
theme_minimal()+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
ggtitle("Proportion of availble doses out of the total population = 0.1")+
labs(color="Risk of infection")
p2
risk_hos.labs=paste0("Risk of hospitalisation: ", seq(0.1:1,by=0.1))
names(risk_hos.labs)=paste0(seq(0.1:1,by=0.1))
p2<-ggplot(d5_sub,aes(x=prop_prohylaxis,y=hos_per_dose,color=as.factor(risk_infection)))+
geom_line()+
# scale_color_brewer(palette = "RdYlBu")+
facet_wrap(~risk_hos,ncol=5,labeller =  labeller(risk_hos=risk_hos.labs))+
xlab("Proportion of prohylaxis doses out of availble doses")+
ylab("Hospitalisations avoided per dose")+
theme_minimal()+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
ggtitle("Proportion of availble doses out of the total population = 0.5")+
labs(color="Risk of infection")
p2
ggsave("doses100_limited_doses.png",last_plot(),height = 8,width = 12)
p1<-ggplot(data=new_dat,aes(x=risk_infection,y=risk_hos,fill=max_avoided_hos_per_dose))+
geom_tile()+
scale_fill_viridis()+
geom_vline(data=NULL,xintercept = xx,linetype="twodash")+
facet_wrap(~availble_doses,ncol = 5,labeller = labeller(availble_doses=availble_doses.labs))+
# geom_text(aes(label=optimal_prohylaxis_dose),size=1.7)+
ylab("Risk of hospitalisation")+
xlab("Risk of infection")+
theme_minimal(14)+
theme(panel.grid.major.x = element_line(colour = "gray", linetype = "dotted"))+
theme(panel.grid.major.y = element_line(colour = "gray", linetype = "dotted"))+
theme(plot.background=element_blank(),
strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_blank(),
#axis.text.x = element_text(angle = -45),
#  strip.text.x = element_blank(),
strip.text.y = element_blank())+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.background = element_blank())+
theme(legend.position="bottom")+
labs(fill="Maximum hospitalisations avoided per dose")
p1
.
all_dat<-data.frame("Dose"=dose,"Hospitalisation"=e_h*100,"Pre_exposure"=e_p*100,"Infectious"=e_t*100)
all_dat=melt(all_dat,id="Dose")
p1=ggplot(data=all_dat,aes(x=Dose,y=value,group=variable,color=variable))+
geom_line(linewidth=1)+
#  geom_hline(data=NULL,aes(yintercept=98.73), linetype="dashed", color = "black")+
# geom_hline(data=NULL,aes(yintercept=90.25), linetype="dashed", color = "black")+
# geom_hline(data=NULL,aes(yintercept=86.99), linetype="dashed", color = "black")+
# xlim(0.1,1000)+
scale_x_continuous(limits = c(0.1,10000),trans='log10')+
scale_color_brewer(palette="Dark2",labels=c("Protection from hospitalisation \n with prophylaxis","Protection from infection \n with prophylaxis","Protection from infection to \n hospitalisation \n with prophylaxis"))+
ylab("Efficacy (%)")+
xlab("Dose administrated (fold convalascent)")+
theme_minimal(14)+
theme(strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
axis.line = element_line(colour = "black"),
# axis.title.y=element_blank(),
strip.text.x = element_text(size = 14),
strip.text.y = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.position="bottom")  +
theme(legend.title=element_blank())
p1
#Assume initial population is 1000
s=1000
#Assume initial population is 1000
s=1000
#baseline risks r_i==risk of exposure and risk of infection and r_h==risk of hospitalisation given infcetion  are from 0 to 1
r_i=seq(0,1,by=0.1)
r_h=seq(0,1,by=0.1)
####prohylcatic treatment
dose=seq(0,1000,by=0.2)
#infcetion given treated prophylactically
eff_inf=get_prophy_inf_curve(dose)
risk_inf_prohy=1-eff_inf
#prophylactic progression to hospitalization
eff_hos=get_prophy_hos_curve(dose)/100
risk_hos_prophy=1-eff_hos
source("C:/Users/z3539374/OneDrive - UNSW/Documents/1_projects/Optimal deployments of antibody/codes/test/GITHUB_version/figure_S1.R", echo=TRUE)
dose=seq(0.1,10000,by=0.1)
e_t=get_prophy_hos_curve(dose,0.87)
e_p=get_prophy_inf_curve(dose,0.9443)
e_h=1-((1-e_p)*(1-e_t))
all_dat<-data.frame("Dose"=dose,"Hospitalisation"=e_h*100,"Pre_exposure"=e_p*100,"Infectious"=e_t*100)
all_dat=melt(all_dat,id="Dose")
p1=ggplot(data=all_dat,aes(x=Dose,y=value,group=variable,color=variable))+
geom_line(linewidth=1)+
scale_x_continuous(limits = c(0.1,10000),trans='log10')+
scale_color_brewer(palette="Dark2",labels=c("Protection from hospitalisation \n with prophylaxis","Protection from infection \n with prophylaxis","Protection from infection to \n hospitalisation \n with prophylaxis"))+
ylab("Efficacy (%)")+
xlab("Dose administrated (fold convalascent)")+
theme_minimal(14)+
theme(strip.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
axis.line = element_line(colour = "black"),
# axis.title.y=element_blank(),
strip.text.x = element_text(size = 14),
strip.text.y = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5))+
theme(legend.position="bottom")  +
theme(legend.title=element_blank())
p1
ggsave('fig_s1.png',last_plot())
load("C:/Users/z3539374/GitHub/mAb_optimal_allocation/.RData")
